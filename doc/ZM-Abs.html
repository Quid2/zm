<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>ZM.Abs</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">zm-0.3.9: Language independent, reproducible, absolute types</span><ul class="links" id="page-menu"><li><a href="src/ZM.Abs.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">ZM.Abs</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Derive absolute/canonical data type models</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:absEnv">absEnv</a> :: <a href="ZM.html#t:Model" title="ZM">Model</a> a =&gt; <a href="ZM-Types.html#t:Proxy" title="ZM.Types">Proxy</a> a -&gt; <a href="ZM-Types.html#t:AbsEnv" title="ZM.Types">AbsEnv</a></li><li class="src short"><a href="#v:absType">absType</a> :: <a href="ZM.html#t:Model" title="ZM">Model</a> a =&gt; <a href="ZM-Types.html#t:Proxy" title="ZM.Types">Proxy</a> a -&gt; <a href="ZM-Types.html#t:AbsType" title="ZM.Types">AbsType</a></li><li class="src short"><a href="#v:absTypeModel">absTypeModel</a> :: <a href="ZM.html#t:Model" title="ZM">Model</a> a =&gt; <a href="ZM-Types.html#t:Proxy" title="ZM.Types">Proxy</a> a -&gt; <a href="ZM-Types.html#t:AbsTypeModel" title="ZM.Types">AbsTypeModel</a></li><li class="src short"><a href="#v:absTypeModelMaybe">absTypeModelMaybe</a> :: <a href="ZM.html#t:Model" title="ZM">Model</a> a =&gt; <a href="ZM-Types.html#t:Proxy" title="ZM.Types">Proxy</a> a -&gt; <a href="../base-4.14.3.0/Data-Either.html#t:Either" title="Data.Either">Either</a> [<a href="ZM-Types.html#t:ZMError" title="ZM.Types">ZMError</a> <a href="ZM-Types.html#t:QualName" title="ZM.Types">QualName</a>] <a href="ZM-Types.html#t:AbsTypeModel" title="ZM.Types">AbsTypeModel</a></li><li class="src short"><a href="#v:relToAbsEnv">relToAbsEnv</a> :: (IsKey r, IsId n) =&gt; RelTypeEnv n r -&gt; <a href="../base-4.14.3.0/Data-Either.html#t:Either" title="Data.Either">Either</a> [<a href="ZM-Types.html#t:ZMError" title="ZM.Types">ZMError</a> r] <a href="ZM-Types.html#t:AbsEnv" title="ZM.Types">AbsEnv</a></li><li class="src short"><a href="#v:relToAbsEnvWith">relToAbsEnvWith</a> :: (IsKey r, IsId n) =&gt; <a href="ZM-Types.html#t:AbsEnv" title="ZM.Types">AbsEnv</a> -&gt; RelTypeEnv n r -&gt; <a href="../base-4.14.3.0/Data-Either.html#t:Either" title="Data.Either">Either</a> [<a href="ZM-Types.html#t:ZMError" title="ZM.Types">ZMError</a> r] <a href="ZM-Types.html#t:AbsEnv" title="ZM.Types">AbsEnv</a></li><li class="src short"><a href="#v:refErrors">refErrors</a> :: (<a href="../base-4.14.3.0/Data-Foldable.html#t:Foldable" title="Data.Foldable">Foldable</a> t, <a href="../base-4.14.3.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> t1) =&gt; <a href="../containers-0.6.5.1/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> t1 (t (<a href="ZM-Types.html#t:ADTRef" title="ZM.Types">ADTRef</a> t1)) -&gt; [<a href="ZM-Types.html#t:ZMError" title="ZM.Types">ZMError</a> t1]</li><li class="src short"><a href="#v:kindErrors">kindErrors</a> :: <a href="../base-4.14.3.0/Data-Ord.html#t:Ord" title="Data.Ord">Ord</a> k =&gt; <a href="../containers-0.6.5.1/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> k (<a href="ZM-Types.html#t:ADT" title="ZM.Types">ADT</a> name1 name2 (<a href="ZM-Abs.html#t:TypeRef2" title="ZM.Abs">TypeRef2</a> a k)) -&gt; [<a href="ZM-Types.html#t:ZMError" title="ZM.Types">ZMError</a> (<a href="../base-4.14.3.0/Data-Either.html#t:Either" title="Data.Either">Either</a> a k)]</li><li class="src short"><span class="keyword">data</span> <a href="#t:TypeRef2">TypeRef2</a> v r<ul class="subs"><li>= <a href="#v:Var2">Var2</a> v</li><li>| <a href="#v:Ext2">Ext2</a> r</li></ul></li><li class="src short"><span class="keyword">class</span> <a href="#t:KeyOf">KeyOf</a> k a <span class="keyword">where</span><ul class="subs"><li><a href="#v:keyOf">keyOf</a> :: a -&gt; k</li></ul></li><li class="src short"><a href="#v:transitiveClosure">transitiveClosure</a> :: (<a href="../base-4.14.3.0/Data-Foldable.html#t:Foldable" title="Data.Foldable">Foldable</a> t, <a href="../base-4.14.3.0/Data-Ord.html#t:Ord" title="Data.Ord">Ord</a> r) =&gt; (a -&gt; <a href="../base-4.14.3.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> r) -&gt; <a href="../containers-0.6.5.1/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> r (t a) -&gt; r -&gt; <a href="../base-4.14.3.0/Data-Either.html#t:Either" title="Data.Either">Either</a> [<a href="ZM-Types.html#t:ZMError" title="ZM.Types">ZMError</a> r] [r]</li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a id="v:absEnv" class="def">absEnv</a> :: <a href="ZM.html#t:Model" title="ZM">Model</a> a =&gt; <a href="ZM-Types.html#t:Proxy" title="ZM.Types">Proxy</a> a -&gt; <a href="ZM-Types.html#t:AbsEnv" title="ZM.Types">AbsEnv</a> <a href="src/ZM.Abs.html#absEnv" class="link">Source</a> <a href="#v:absEnv" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:absType" class="def">absType</a> :: <a href="ZM.html#t:Model" title="ZM">Model</a> a =&gt; <a href="ZM-Types.html#t:Proxy" title="ZM.Types">Proxy</a> a -&gt; <a href="ZM-Types.html#t:AbsType" title="ZM.Types">AbsType</a> <a href="src/ZM.Abs.html#absType" class="link">Source</a> <a href="#v:absType" class="selflink">#</a></p><div class="doc"><p>Derive an absolute type for a type, or throw an error if derivation is impossible</p></div></div><div class="top"><p class="src"><a id="v:absTypeModel" class="def">absTypeModel</a> :: <a href="ZM.html#t:Model" title="ZM">Model</a> a =&gt; <a href="ZM-Types.html#t:Proxy" title="ZM.Types">Proxy</a> a -&gt; <a href="ZM-Types.html#t:AbsTypeModel" title="ZM.Types">AbsTypeModel</a> <a href="src/ZM.Abs.html#absTypeModel" class="link">Source</a> <a href="#v:absTypeModel" class="selflink">#</a></p><div class="doc"><p>Derive an absolute type model for a type, or throw an error if derivation is impossible</p></div></div><div class="top"><p class="src"><a id="v:absTypeModelMaybe" class="def">absTypeModelMaybe</a> :: <a href="ZM.html#t:Model" title="ZM">Model</a> a =&gt; <a href="ZM-Types.html#t:Proxy" title="ZM.Types">Proxy</a> a -&gt; <a href="../base-4.14.3.0/Data-Either.html#t:Either" title="Data.Either">Either</a> [<a href="ZM-Types.html#t:ZMError" title="ZM.Types">ZMError</a> <a href="ZM-Types.html#t:QualName" title="ZM.Types">QualName</a>] <a href="ZM-Types.html#t:AbsTypeModel" title="ZM.Types">AbsTypeModel</a> <a href="src/ZM.Abs.html#absTypeModelMaybe" class="link">Source</a> <a href="#v:absTypeModelMaybe" class="selflink">#</a></p><div class="doc"><p>Derive an absolute type model for a type, composed of the type plus its full type environment (all the types the type depends upon directly or indirectly)</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>let Right t = absTypeModelMaybe (Proxy :: Proxy [Bool]) in error . prettyShow $ t
</code></strong>Type: List Bool (Kb8cd13187198 K306f1981b41c)
Environment:
Bool.K306f1981b41c &#8801;   False
                     | True;
List.Kb8cd13187198 a &#8801;   Nil
                       | Cons a (List.Kb8cd13187198 a);
</pre><p>Mutual dependencies are not supported:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>data A = A B deriving (Model,Generic);data B = B A deriving (Model,Generic)
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>error . prettyShow $ absTypeModelMaybe (Proxy :: Proxy A)
</code></strong>Left [Found mutually recursive types: [interactive.Ghci2.B,
                                       interactive.Ghci2.A]]
</pre><p>Higher kind types are also not supported (this is detected at compile time as it is not possible to derive a Model instance):</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>data Free f a = Impure (f (Free f a)) | Pure a deriving Model
</code></strong>Could not deduce (AsType (Ana a))
  arising from the 'deriving' clause of a data type declaration
from the context: (Typeable f, Typeable a)
  bound by the deriving clause for &#8216;Model (Free f a)&#8217;
  at &lt;interactive&gt;:1:58-62
Possible fix:
  use a standalone 'deriving instance' declaration,
    so you can specify the instance context yourself
</pre></div></div><div class="top"><p class="src"><a id="v:relToAbsEnv" class="def">relToAbsEnv</a> :: (IsKey r, IsId n) =&gt; RelTypeEnv n r -&gt; <a href="../base-4.14.3.0/Data-Either.html#t:Either" title="Data.Either">Either</a> [<a href="ZM-Types.html#t:ZMError" title="ZM.Types">ZMError</a> r] <a href="ZM-Types.html#t:AbsEnv" title="ZM.Types">AbsEnv</a> <a href="src/ZM.Abs.html#relToAbsEnv" class="link">Source</a> <a href="#v:relToAbsEnv" class="selflink">#</a></p><div class="doc"><p>Convert a set of relative ADTs to the equivalent ZM absolute ADTs</p></div></div><div class="top"><p class="src"><a id="v:relToAbsEnvWith" class="def">relToAbsEnvWith</a> :: (IsKey r, IsId n) =&gt; <a href="ZM-Types.html#t:AbsEnv" title="ZM.Types">AbsEnv</a> -&gt; RelTypeEnv n r -&gt; <a href="../base-4.14.3.0/Data-Either.html#t:Either" title="Data.Either">Either</a> [<a href="ZM-Types.html#t:ZMError" title="ZM.Types">ZMError</a> r] <a href="ZM-Types.html#t:AbsEnv" title="ZM.Types">AbsEnv</a> <a href="src/ZM.Abs.html#relToAbsEnvWith" class="link">Source</a> <a href="#v:relToAbsEnvWith" class="selflink">#</a></p><div class="doc"><p>Convert a set of relative ADTs to the equivalent ZM absolute ADTs, with a starting set of known absolute ADTs.</p><p>Conversion will fail if the relative ADTs are mutually recursive or refer to undefined ADTs.</p></div></div><div class="top"><p class="src"><a id="v:refErrors" class="def">refErrors</a> :: (<a href="../base-4.14.3.0/Data-Foldable.html#t:Foldable" title="Data.Foldable">Foldable</a> t, <a href="../base-4.14.3.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> t1) =&gt; <a href="../containers-0.6.5.1/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> t1 (t (<a href="ZM-Types.html#t:ADTRef" title="ZM.Types">ADTRef</a> t1)) -&gt; [<a href="ZM-Types.html#t:ZMError" title="ZM.Types">ZMError</a> t1] <a href="src/ZM.Abs.html#refErrors" class="link">Source</a> <a href="#v:refErrors" class="selflink">#</a></p><div class="doc"><p>Check that all internal references in the ADT definitions are to ADTs defined in the environment
 This test is also performed as part of the relative to absolute conversion (<code><a href="ZM-Abs.html#v:relToAbsEnv" title="ZM.Abs">relToAbsEnv</a></code>)</p></div></div><div class="top"><p class="src"><a id="v:kindErrors" class="def">kindErrors</a> :: <a href="../base-4.14.3.0/Data-Ord.html#t:Ord" title="Data.Ord">Ord</a> k =&gt; <a href="../containers-0.6.5.1/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> k (<a href="ZM-Types.html#t:ADT" title="ZM.Types">ADT</a> name1 name2 (<a href="ZM-Abs.html#t:TypeRef2" title="ZM.Abs">TypeRef2</a> a k)) -&gt; [<a href="ZM-Types.html#t:ZMError" title="ZM.Types">ZMError</a> (<a href="../base-4.14.3.0/Data-Either.html#t:Either" title="Data.Either">Either</a> a k)] <a href="src/ZM.Abs.html#kindErrors" class="link">Source</a> <a href="#v:kindErrors" class="selflink">#</a></p></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:TypeRef2" class="def">TypeRef2</a> v r <a href="src/ZM.Abs.html#TypeRef2" class="link">Source</a> <a href="#t:TypeRef2" class="selflink">#</a></p><div class="doc"><p>Check that all type expressions have kind <code><a href="../base-4.14.3.0/Prelude.html#v:-42-" title="Prelude">*</a></code>, that's to say:</p><ul><li>Type constructors are fully applied</li><li>Type variables have * kind</li></ul></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:Var2" class="def">Var2</a> v</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:Ext2" class="def">Ext2</a> r</td><td class="doc empty">&nbsp;</td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">class</span> <a id="t:KeyOf" class="def">KeyOf</a> k a <span class="keyword">where</span> <a href="src/ZM.Abs.html#KeyOf" class="link">Source</a> <a href="#t:KeyOf" class="selflink">#</a></p><div class="subs methods"><p class="caption">Methods</p><p class="src"><a id="v:keyOf" class="def">keyOf</a> :: a -&gt; k <a href="src/ZM.Abs.html#keyOf" class="link">Source</a> <a href="#v:keyOf" class="selflink">#</a></p></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:KeyOf">Instances</h4><details id="i:KeyOf" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:ic:KeyOf:KeyOf:1"></span> <a href="ZM-Abs.html#t:KeyOf" title="ZM.Abs">KeyOf</a> <a href="ZM-Types.html#t:QualName" title="ZM.Types">QualName</a> (<a href="ZM-Types.html#t:AbsRef" title="ZM.Types">AbsRef</a>, <a href="ZM-Types.html#t:AbsADT" title="ZM.Types">AbsADT</a>)</span> <a href="src/ZM.Abs.html#line-53" class="link">Source</a> <a href="#t:KeyOf" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:ic:KeyOf:KeyOf:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="ZM-Abs.html">ZM.Abs</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:keyOf">keyOf</a> :: (<a href="ZM-Types.html#t:AbsRef" title="ZM.Types">AbsRef</a>, <a href="ZM-Types.html#t:AbsADT" title="ZM.Types">AbsADT</a>) -&gt; <a href="ZM-Types.html#t:QualName" title="ZM.Types">QualName</a> <a href="src/ZM.Abs.html#keyOf" class="link">Source</a> <a href="#v:keyOf" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:ic:KeyOf:KeyOf:2"></span> <a href="ZM-Abs.html#t:KeyOf" title="ZM.Abs">KeyOf</a> (<a href="ZM-Parser-Types.html#t:At" title="ZM.Parser.Types">At</a> (<a href="ZM-Parser-Types.html#t:TypeName" title="ZM.Parser.Types">TypeName</a> <a href="ZM-Types.html#t:Identifier" title="ZM.Types">Identifier</a>)) (<a href="ZM-Types.html#t:AbsRef" title="ZM.Types">AbsRef</a>, <a href="ZM-Types.html#t:AbsADT" title="ZM.Types">AbsADT</a>)</span> <a href="src/ZM.Parser.Env.html#line-332" class="link">Source</a> <a href="#t:KeyOf" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:ic:KeyOf:KeyOf:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="ZM-Parser-Env.html">ZM.Parser.Env</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:keyOf">keyOf</a> :: (<a href="ZM-Types.html#t:AbsRef" title="ZM.Types">AbsRef</a>, <a href="ZM-Types.html#t:AbsADT" title="ZM.Types">AbsADT</a>) -&gt; <a href="ZM-Parser-Types.html#t:At" title="ZM.Parser.Types">At</a> (<a href="ZM-Parser-Types.html#t:TypeName" title="ZM.Parser.Types">TypeName</a> <a href="ZM-Types.html#t:Identifier" title="ZM.Types">Identifier</a>) <a href="src/ZM.Abs.html#keyOf" class="link">Source</a> <a href="#v:keyOf" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><a id="v:transitiveClosure" class="def">transitiveClosure</a> :: (<a href="../base-4.14.3.0/Data-Foldable.html#t:Foldable" title="Data.Foldable">Foldable</a> t, <a href="../base-4.14.3.0/Data-Ord.html#t:Ord" title="Data.Ord">Ord</a> r) =&gt; (a -&gt; <a href="../base-4.14.3.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> r) -&gt; <a href="../containers-0.6.5.1/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> r (t a) -&gt; r -&gt; <a href="../base-4.14.3.0/Data-Either.html#t:Either" title="Data.Either">Either</a> [<a href="ZM-Types.html#t:ZMError" title="ZM.Types">ZMError</a> r] [r] <a href="src/ZM.Abs.html#transitiveClosure" class="link">Source</a> <a href="#v:transitiveClosure" class="selflink">#</a></p><div class="doc"><p>Return the transitive closure of an element in a graph of dependencies specified as an adjacency list</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>transitiveClosure Just (M.fromList [(&quot;a&quot;,[&quot;b&quot;,&quot;c&quot;]),(&quot;b&quot;,[&quot;b&quot;,&quot;d&quot;,&quot;d&quot;,&quot;c&quot;]),(&quot;c&quot;,[]),(&quot;d&quot;,[&quot;a&quot;])]) &quot;b&quot;
</code></strong>Right [&quot;c&quot;,&quot;a&quot;,&quot;d&quot;,&quot;b&quot;]
</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>transitiveClosure Just (M.fromList [(&quot;a&quot;,[&quot;b&quot;,&quot;c&quot;]),(&quot;b&quot;,[&quot;b&quot;,&quot;d&quot;,&quot;d&quot;,&quot;c&quot;]),(&quot;c&quot;,[]),(&quot;d&quot;,[&quot;a&quot;])]) &quot;c&quot;
</code></strong>Right [&quot;c&quot;]
</pre></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.24.2</p></div></body></html>